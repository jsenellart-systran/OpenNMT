
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.10.2">
    
    
      
        <title>Models - OpenNMT</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-408828a02a.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="OpenNMT" class="md-header-nav__button md-logo">
          
            
              <img src="../../img/logo-alpha.png" width="24" height="24">
            
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Training
                </span>
              
            
            Models
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/OpenNMT/OpenNMT" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      OpenNMT/OpenNMT
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <div class="md-nav__button md-logo">
      
        
          <img src="../../img/logo-alpha.png">
        
      
    </div>
    OpenNMT
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/OpenNMT/OpenNMT" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      OpenNMT/OpenNMT
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../applications/" title="Applications" class="md-nav__link">
      Applications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/preparation/" title="Preparation" class="md-nav__link">
      Preparation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/word_features/" title="Word features" class="md-nav__link">
      Word features
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Training
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Training
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Models
      </label>
    
    <a href="./" title="Models" class="md-nav__link md-nav__link--active">
      Models
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#encoders" title="Encoders" class="md-nav__link">
    Encoders
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-encoder" title="Default encoder" class="md-nav__link">
    Default encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bidirectional-encoder" title="Bidirectional encoder" class="md-nav__link">
    Bidirectional encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyramidal-deep-bidirectional-encoder" title="Pyramidal deep bidirectional encoder" class="md-nav__link">
    Pyramidal deep bidirectional encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deep-bidirectional-encoder" title="Deep bidirectional encoder" class="md-nav__link">
    Deep bidirectional encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#googles-nmt-encoder" title="Google's NMT encoder" class="md-nav__link">
    Google's NMT encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convolutional-encoder" title="Convolutional encoder" class="md-nav__link">
    Convolutional encoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoders" title="Decoders" class="md-nav__link">
    Decoders
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-decoder" title="Default decoder" class="md-nav__link">
    Default decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#residual-connections" title="Residual connections" class="md-nav__link">
    Residual connections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bridges" title="Bridges" class="md-nav__link">
    Bridges
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attention-model" title="Attention Model" class="md-nav__link">
    Attention Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scheduled-sampling" title="Scheduled Sampling" class="md-nav__link">
    Scheduled Sampling
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../embeddings/" title="Embeddings" class="md-nav__link">
      Embeddings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../logs/" title="Logs" class="md-nav__link">
      Logs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../multi_gpu/" title="Multi GPU" class="md-nav__link">
      Multi GPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../retraining/" title="Retraining" class="md-nav__link">
      Retraining
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../regularization/" title="Regularization" class="md-nav__link">
      Regularization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../decay/" title="Decay strategies" class="md-nav__link">
      Decay strategies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sampling/" title="Data sampling" class="md-nav__link">
      Data sampling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Translation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Translation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../translation/inference/" title="Inference" class="md-nav__link">
      Inference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../translation/beam_search/" title="Beam search" class="md-nav__link">
      Beam search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../translation/unknowns/" title="Unknown words" class="md-nav__link">
      Unknown words
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/tokenization/" title="Tokenization" class="md-nav__link">
      Tokenization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/scorer/" title="Scorer" class="md-nav__link">
      Scorer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/servers/" title="Servers" class="md-nav__link">
      Servers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Reference: Options
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Reference: Options
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/usage/" title="Scripts usage" class="md-nav__link">
      Scripts usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/preprocess/" title="preprocess.lua" class="md-nav__link">
      preprocess.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/train/" title="train.lua" class="md-nav__link">
      train.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/translate/" title="translate.lua" class="md-nav__link">
      translate.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/tag/" title="tag.lua" class="md-nav__link">
      tag.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/lm/" title="lm.lua" class="md-nav__link">
      lm.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/build_vocab/" title="tools/build_vocab.lua" class="md-nav__link">
      tools/build_vocab.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/release_model/" title="tools/release_model.lua" class="md-nav__link">
      tools/release_model.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/tokenize/" title="tools/tokenize.lua" class="md-nav__link">
      tools/tokenize.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/learn_bpe/" title="tools/learn_bpe.lua" class="md-nav__link">
      tools/learn_bpe.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/server/" title="tools/translation_server.lua" class="md-nav__link">
      tools/translation_server.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/rest_server/" title="tools/rest_translation_server.lua" class="md-nav__link">
      tools/rest_translation_server.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/embeddings/" title="tools/embeddings.lua" class="md-nav__link">
      tools/embeddings.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/average_models/" title="tools/average_models.lua" class="md-nav__link">
      tools/average_models.lua
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../lua_python_comparison/" title="Lua and Python OpenNMT" class="md-nav__link">
      Lua and Python OpenNMT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../references/" title="References" class="md-nav__link">
      References
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../issues/" title="Common issues" class="md-nav__link">
      Common issues
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#encoders" title="Encoders" class="md-nav__link">
    Encoders
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-encoder" title="Default encoder" class="md-nav__link">
    Default encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bidirectional-encoder" title="Bidirectional encoder" class="md-nav__link">
    Bidirectional encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyramidal-deep-bidirectional-encoder" title="Pyramidal deep bidirectional encoder" class="md-nav__link">
    Pyramidal deep bidirectional encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deep-bidirectional-encoder" title="Deep bidirectional encoder" class="md-nav__link">
    Deep bidirectional encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#googles-nmt-encoder" title="Google's NMT encoder" class="md-nav__link">
    Google's NMT encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convolutional-encoder" title="Convolutional encoder" class="md-nav__link">
    Convolutional encoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoders" title="Decoders" class="md-nav__link">
    Decoders
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-decoder" title="Default decoder" class="md-nav__link">
    Default decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#residual-connections" title="Residual connections" class="md-nav__link">
    Residual connections
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bridges" title="Bridges" class="md-nav__link">
    Bridges
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attention-model" title="Attention Model" class="md-nav__link">
    Attention Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scheduled-sampling" title="Scheduled Sampling" class="md-nav__link">
    Scheduled Sampling
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/OpenNMT/OpenNMT/edit/master/docs/training/models.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Models</h1>
                
                <p>In addition to standard dimension settings like the number of layers, the hidden dimension size, etc., OpenNMT also provides various model architecture.</p>
<h2 id="encoders">Encoders<a class="headerlink" href="#encoders" title="Permanent link">&para;</a></h2>
<h3 id="default-encoder">Default encoder<a class="headerlink" href="#default-encoder" title="Permanent link">&para;</a></h3>
<p>The default encoder is a simple recurrent neural network (LSTM or GRU).</p>
<h3 id="bidirectional-encoder">Bidirectional encoder<a class="headerlink" href="#bidirectional-encoder" title="Permanent link">&para;</a></h3>
<p>The bidirectional encoder (<code>-encoder_type brnn</code>) consists of two independent encoders: one encoding the normal sequence and the other the reversed sequence. The output and final states are concatenated or summed depending on the <code>-brnn_merge</code> option.</p>
<p><img alt="Bidirectional encoder" src="../../img/brnn.png" /></p>
<h3 id="pyramidal-deep-bidirectional-encoder">Pyramidal deep bidirectional encoder<a class="headerlink" href="#pyramidal-deep-bidirectional-encoder" title="Permanent link">&para;</a></h3>
<p>The pyramidal deep bidirectional encoder (<code>-encoder_type pdbrnn</code>) is an alternative bidirectional encoder that reduces the time dimension after <strong>each</strong> layer based on the <code>-pdbrnn_reduction</code> factor and using <code>-pdbrnn_merge</code> as the reduction action (sum or concatenation).</p>
<p><img alt="Pyramidal deep bidirectional encoder" src="../../img/pdbrnn.png" /></p>
<h3 id="deep-bidirectional-encoder">Deep bidirectional encoder<a class="headerlink" href="#deep-bidirectional-encoder" title="Permanent link">&para;</a></h3>
<p>The deep bidirectional encoder (<code>-encoder_type dbrnn</code>) is an alternative bidirectional encoder where the outputs of every layers are summed (or concatenated) prior feeding to the next layer. It is a special case of a pyramidal deep bidirectional encoder without time reduction (i.e. <code>-pdbrnn_reduction = 1</code>).</p>
<p><img alt="Deep bidirectional encoder" src="../../img/dbrnn.png" /></p>
<h3 id="googles-nmt-encoder">Google's NMT encoder<a class="headerlink" href="#googles-nmt-encoder" title="Permanent link">&para;</a></h3>
<p>The Google encoder (<code>-encoder_type gnmt</code>) is an encoder with a single bidirectional layer as described in <a href="../../references/#GNMT">Wu et al. (2016)</a>. The bidirectional states are concatenated and residual connections are enabled by default.</p>
<p><img alt="Google's NMT encoder" src="../../img/gnmt-encoder.png" /></p>
<h3 id="convolutional-encoder">Convolutional encoder<a class="headerlink" href="#convolutional-encoder" title="Permanent link">&para;</a></h3>
<p>The convolutional encoder (<code>-encoder_type cnn</code>) is an encoder based on several convolutional layers as described in <a href="../../references/#CNNEncoder">Gehring et al. (2017)</a>.</p>
<p>In sequence-to-sequence models, it should be used either without a bridge or with a dense bridge (options <code>-bridge dense</code>, <code>-bridge dense_nonlinear</code>, or <code>-bridge none</code>). The default <code>copy</code> bridge is not compatible with this encoder.</p>
<p>It is also recommended to set a small learning rate when using SGD (e.g. <code>-learning_rate 0.1</code>) or use Adam instead (e.g. <code>-optim adam -learning_rate 0.0002</code>).</p>
<h2 id="decoders">Decoders<a class="headerlink" href="#decoders" title="Permanent link">&para;</a></h2>
<h3 id="default-decoder">Default decoder<a class="headerlink" href="#default-decoder" title="Permanent link">&para;</a></h3>
<p>The default decoder applies attention over the source sequence and implements input feeding by default.</p>
<p>Input feeding is an approach to feed attentional vectors "<em>as inputs to the next time steps to inform the model about past alignment decisions</em>" (<a href="https://arxiv.org/pdf/1508.04025.pdf">Luong et al. (2015)</a>). This can be disabled by setting <code>-input_feed 0</code>.</p>
<p><img alt="Decoder with input feeding" src="../../img/input_feed.png" /></p>
<h2 id="residual-connections">Residual connections<a class="headerlink" href="#residual-connections" title="Permanent link">&para;</a></h2>
<p>With residual connections the input of a layer is element-wise added to the output before feeding to the next layer. This approach proved to be useful for the gradient flow with deep RNN stacks (more than 4 layers).</p>
<p><img alt="RNN with residual connections" src="../../img/residual.png" /></p>
<p>The following components support residual connections with the <code>-residual</code> flag:</p>
<ul>
<li>default encoder</li>
<li>bidirectional encoder</li>
<li>default decoder</li>
</ul>
<h2 id="bridges">Bridges<a class="headerlink" href="#bridges" title="Permanent link">&para;</a></h2>
<p>A bridge is an additional layer between the encoder and the decoder that defines how to pass the encoder states to the decoder. It can be one of the following:</p>
<ul>
<li><code>-bridge copy</code> (default): the encoder states are copied</li>
<li><code>-bridge dense</code>: the encoder states are forwaded through a dense layer</li>
<li><code>-bridge dense_nonlinear</code>: the encoder states are forwaded through a dense layer followed by a non-linearity, here (tanh)</li>
<li><code>-bridge none</code>: the encoder states are not passed and the decoder initial states are set to zero</li>
</ul>
<p>With the <code>copy</code> bridge, encoder and decoder should have the same structure (number of layers, final hidden size, etc.).</p>
<h2 id="attention-model">Attention Model<a class="headerlink" href="#attention-model" title="Permanent link">&para;</a></h2>
<p>Different models are available from <a href="../../references/#Luong2015">Luong (2015)</a> "Global Attention Model".</p>
<p><img alt="Global attentional model" src="../../img/global-attention-model.png" /></p>
<p>where:</p>
<p>$$a_t(s) = \frac{\mathrm{exp}(\mathrm{score}(h_t,\bar{h}<em>s))}{\sum</em>{s'} \mathrm{exp}(\mathrm{score}(h_t,\bar{h}_s)}$$</p>
<p>and the score function is one of these:</p>
<ul>
<li><code>dot</code>: $$\mathrm{score}(h_t,\bar{h}_s)=h_t^T\bar{h}_s$$</li>
<li><code>general</code>: $$\mathrm{score}(h_t,\bar{h}_s)=h_t^TW_a\bar{h}_s$$</li>
<li><code>concat</code>: $$\mathrm{score}(h_t,\bar{h}_s)=\nu_a^T.\mathrm{tanh}(W_a[h_t;\bar{h}_s])$$</li>
</ul>
<p>The model is selected using <code>-global_attention</code> option or can be disabled with <code>-attention none</code> option. The default attention model is <code>general</code>.</p>
<h2 id="scheduled-sampling">Scheduled Sampling<a class="headerlink" href="#scheduled-sampling" title="Permanent link">&para;</a></h2>
<p>By default, the decoder at step (t) is using the reference token for step (t-1) to calculate the new output. For some applications, for instance speech recognition, this is leading to propagation of decoding errors and also a mismatch between training and inference workflow. Scheduled sampling (as introduced in <a href="http://papers.nips.cc/paper/5956-scheduled-sampling-for-sequence-prediction-with-recurrent-neural-networks.pdf">Scheduled sampling for sequence prediction with recurrent neural networks</a>. In Advances in Neural Information Processing Systems (pp. 1171-1179).]) is allowing to mix gold reference and generated output in a proportion that will change over time: at the beginning of the training the generated output confidence is very low and it is better to use gold reference, while at the end of the training, we have to rely on generated output to have training in the same conditions than inference.</p>
<p>Scheduled sampling is activated with <code>-scheduled_sampling</code> parameter which takes the probability to use the reference token instead of the previously generated one. By default, probability is one meaning that we always use previously generated token. The sampling can be done either at each token level or at the sentence level using <code>-scheduled_sampling_scope</code> parameter. The decay of the sampling rate is controlled by parameters <code>-scheduled_sampling_decay_type</code> and <code>-scheduled_sampling_decay_rate</code>.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../data/word_features/" title="Word features" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Word features
              </span>
            </div>
          </a>
        
        
          <a href="../embeddings/" title="Embeddings" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Embeddings
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://opennmt.net" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/OpenNMT/OpenNMT" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-f3ab9e5ff8.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-89222039-1","opennmt.net"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>