<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Word features - OpenNMT</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-89222039-1', 'opennmt.net');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">OpenNMT</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Overview</a>
                    </li>
                    <li >
                        <a href="../../installation/">Installation</a>
                    </li>
                    <li >
                        <a href="../../quickstart/">Quickstart</a>
                    </li>
                    <li >
                        <a href="../../applications/">Applications</a>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Data <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../preparation/">Preparation</a>
</li>
                            
<li class="active">
    <a href="./">Word features</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Training <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../training/models/">Models</a>
</li>
                            
<li >
    <a href="../../training/embeddings/">Embeddings</a>
</li>
                            
<li >
    <a href="../../training/logs/">Logs</a>
</li>
                            
<li >
    <a href="../../training/multi_gpu/">Multi GPU</a>
</li>
                            
<li >
    <a href="../../training/retraining/">Retraining</a>
</li>
                            
<li >
    <a href="../../training/regularization/">Regularization</a>
</li>
                            
<li >
    <a href="../../training/decay/">Decay strategies</a>
</li>
                            
<li >
    <a href="../../training/sampling/">Data sampling</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Translation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../translation/inference/">Inference</a>
</li>
                            
<li >
    <a href="../../translation/beam_search/">Beam search</a>
</li>
                            
<li >
    <a href="../../translation/unknowns/">Unknown words</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tools <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tools/tokenization/">Tokenization</a>
</li>
                            
<li >
    <a href="../../tools/scorer/">Scorer</a>
</li>
                            
<li >
    <a href="../../tools/servers/">Servers</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference: Options <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../options/usage/">Scripts usage</a>
</li>
                            
<li >
    <a href="../../options/preprocess/">preprocess.lua</a>
</li>
                            
<li >
    <a href="../../options/train/">train.lua</a>
</li>
                            
<li >
    <a href="../../options/translate/">translate.lua</a>
</li>
                            
<li >
    <a href="../../options/tag/">tag.lua</a>
</li>
                            
<li >
    <a href="../../options/lm/">lm.lua</a>
</li>
                            
<li >
    <a href="../../options/build_vocab/">tools/build_vocab.lua</a>
</li>
                            
<li >
    <a href="../../options/release_model/">tools/release_model.lua</a>
</li>
                            
<li >
    <a href="../../options/tokenize/">tools/tokenize.lua</a>
</li>
                            
<li >
    <a href="../../options/learn_bpe/">tools/learn_bpe.lua</a>
</li>
                            
<li >
    <a href="../../options/server/">tools/translation_server.lua</a>
</li>
                            
<li >
    <a href="../../options/rest_server/">tools/rest_translation_server.lua</a>
</li>
                            
<li >
    <a href="../../options/embeddings/">tools/embeddings.lua</a>
</li>
                            
<li >
    <a href="../../options/average_models/">tools/average_models.lua</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../../lua_python_comparison/">Lua and Python OpenNMT</a>
                    </li>
                    <li >
                        <a href="../../references/">References</a>
                    </li>
                    <li >
                        <a href="../../issues/">Common issues</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../preparation/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../../training/models/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/OpenNMT/OpenNMT">OpenNMT/OpenNMT
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#time-shifting">Time-shifting</a></li>
        <li class="main "><a href="#vocabularies">Vocabularies</a></li>
        <li class="main "><a href="#embeddings">Embeddings</a></li>
        <li class="main "><a href="#beam-search">Beam search</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>OpenNMT supports additional features on source and target words in the form of <strong>discrete labels</strong>.</p>
<ul>
<li>On the source side, these features act as <strong>additional information</strong> to the encoder. An
embedding will be optimized for each label and then fed as additional source input
alongside the word it annotates.</li>
<li>On the target side, these features will be <strong>predicted</strong> by the network. The
decoder is then able to decode a sentence and annotate each word.</li>
</ul>
<p>To use additional features, directly modify your data by appending labels to each word with
the special character <code>￨</code> (unicode character FFE8). There can be an <strong>arbitrary number</strong> of additional
features in the form <code>word￨feat1￨feat2￨...￨featN</code> but each word must have the same number of
features and in the same order. Source and target data can have a different number of additional features.</p>
<p>As an example, see <code>data/src-train-case.txt</code> which uses a separate feature
to represent the case of each word. Using case as a feature is a way to optimize the word
dictionary (no duplicated words like "the" and "The") and gives the system an additional
information that can be useful to optimize its objective function.</p>
<div class="codehilite"><pre><span></span>it￨C is￨l not￨l acceptable￨l that￨l ,￨n with￨l the￨l help￨l of￨l the￨l national￨l bureaucracies￨l ,￨n parliament￨C &amp;apos;s￨l legislative￨l prerogative￨l should￨l be￨l made￨l null￨l and￨l void￨l by￨l means￨l of￨l implementing￨l provisions￨l whose￨l content￨l ,￨n purpose￨l and￨l extent￨l are￨l not￨l laid￨l down￨l in￨l advance￨l .￨n
</pre></div>


<p>You can generate this case feature with OpenNMT's tokenization script and the <code>-case_feature</code> flag.</p>
<h2 id="time-shifting">Time-shifting<a class="headerlink" href="#time-shifting" title="Permanent link">&para;</a></h2>
<p>By default, word features on the target side are automatically shifted compared to the words so that their prediction directly depends on the word they annotate. This way, the decoder architecture is similar to a RNN-based sequence tagger with the output of a timestep being the tag of the input.</p>
<p>More precisely at timestep (t):</p>
<ul>
<li>the inputs are (words^{(t)}) and (features^{(t-1)})</li>
<li>the outputs are (words^{(t+1)}) and (features^{(t)})</li>
</ul>
<p>To reuse available vocabulary, (features^{(-1)}) is set to the end of sentence token.</p>
<h2 id="vocabularies">Vocabularies<a class="headerlink" href="#vocabularies" title="Permanent link">&para;</a></h2>
<p>By default, features vocabulary size is unlimited. Depending on the type of features you are using, you may want to limit their vocabulary during the preprocessing with the <code>-src_vocab_size</code> and <code>-tgt_vocab_size</code> options in the format <code>word_vocab_size[ feat1_vocab_size[ feat2_vocab_size[ ...]]]</code>. For example:</p>
<div class="codehilite"><pre><span></span><span class="c1"># unlimited source features vocabulary size</span>
-src_vocab_size <span class="m">50000</span>

<span class="c1"># first feature vocabulary is limited to 60, others are unlimited</span>
-src_vocab_size <span class="m">50000</span> <span class="m">60</span>

<span class="c1"># second feature vocabulary is limited to 100, others are unlimited</span>
-src_vocab_size <span class="m">50000</span> <span class="m">0</span> <span class="m">100</span>

<span class="c1"># limit vocabulary size of the first and second feature</span>
-src_vocab_size <span class="m">50000</span> <span class="m">60</span> <span class="m">100</span>
</pre></div>


<p>You can similarly use <code>-src_words_min_frequency</code> and <code>-tgt_words_min_frequency</code> to limit vocabulary by frequency instead of absolute size.</p>
<p>Like words, word features vocabularies can be reused across datasets with the <code>-features_vocabs_prefix</code>. For example, if the processing generates theses features dictionaries:</p>
<ul>
<li><code>data/demo.source_feature_1.dict</code></li>
<li><code>data/demo.source_feature_2.dict</code></li>
<li><code>data/demo.source_feature_3.dict</code></li>
</ul>
<p>you have to set <code>-features_vocabs_prefix data/demo</code> as command line option.</p>
<h2 id="embeddings">Embeddings<a class="headerlink" href="#embeddings" title="Permanent link">&para;</a></h2>
<p>The feature embedding size is automatically computed based on the number of values the feature takes. This default size reduction works well for features with few values like the case or POS.</p>
<p>For other features, you may want to manually choose the embedding size with the <code>-src_word_vec_size</code> and <code>-tgt_word_vec_size</code> options. They behave similarly to <code>-src_vocab_size</code> with a list of embedding size: <code>word_vec_size[ feat1_vec_size[ feat2_vec_size[ ...]]]</code>.</p>
<p>Then, each feature embedding is concatenated to each other by default. You can instead choose to sum them by setting <code>-feat_merge sum</code>. Finally, the resulting merged embedding is concatenated to the word embedding.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In the <code>sum</code> case, each feature embedding must have the same dimension. You can set the common embedding size with <code>-feat_vec_size</code>.</p>
</div>
<h2 id="beam-search">Beam search<a class="headerlink" href="#beam-search" title="Permanent link">&para;</a></h2>
<p>During decoding, the beam search is only applied on the target words space and not on the word features. When the beam path is complete, the associated features are selected along this path.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
