
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.10.2">
    
    
      
        <title>Beam search - OpenNMT</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-408828a02a.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/version-select.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="OpenNMT" class="md-header-nav__button md-logo">
          
            
              <img src="../../img/logo-alpha.png" width="24" height="24">
            
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Translation
                </span>
              
            
            Beam search
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/OpenNMT/OpenNMT" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      OpenNMT/OpenNMT
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <div class="md-nav__button md-logo">
      
        
          <img src="../../img/logo-alpha.png">
        
      
    </div>
    OpenNMT
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/OpenNMT/OpenNMT" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      OpenNMT/OpenNMT
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../applications/" title="Applications" class="md-nav__link">
      Applications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/preparation/" title="Preparation" class="md-nav__link">
      Preparation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/word_features/" title="Word features" class="md-nav__link">
      Word features
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Training
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Training
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/embeddings/" title="Embeddings" class="md-nav__link">
      Embeddings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/logs/" title="Logs" class="md-nav__link">
      Logs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/multi_gpu/" title="Multi GPU" class="md-nav__link">
      Multi GPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/retraining/" title="Retraining" class="md-nav__link">
      Retraining
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/regularization/" title="Regularization" class="md-nav__link">
      Regularization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/decay/" title="Decay strategies" class="md-nav__link">
      Decay strategies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/sampling/" title="Data sampling" class="md-nav__link">
      Data sampling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Translation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Translation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../inference/" title="Inference" class="md-nav__link">
      Inference
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Beam search
      </label>
    
    <a href="./" title="Beam search" class="md-nav__link md-nav__link--active">
      Beam search
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hypotheses-filtering" title="Hypotheses filtering" class="md-nav__link">
    Hypotheses filtering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#normalization" title="Normalization" class="md-nav__link">
    Normalization
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#length-normalization" title="Length normalization" class="md-nav__link">
    Length normalization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coverage-normalization" title="Coverage normalization" class="md-nav__link">
    Coverage normalization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-of-sentence-normalization" title="End of sentence normalization" class="md-nav__link">
    End of sentence normalization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoding-with-auxiliary-language-model" title="Decoding with auxiliary language model" class="md-nav__link">
    Decoding with auxiliary language model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-attention-to-a-file" title="Output attention to a file" class="md-nav__link">
    Output attention to a file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualizing-the-beam-search" title="Visualizing the beam search" class="md-nav__link">
    Visualizing the beam search
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../unknowns/" title="Unknown words" class="md-nav__link">
      Unknown words
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/tokenization/" title="Tokenization" class="md-nav__link">
      Tokenization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/scorer/" title="Scorer" class="md-nav__link">
      Scorer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/servers/" title="Servers" class="md-nav__link">
      Servers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Reference: Options
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Reference: Options
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/usage/" title="Scripts usage" class="md-nav__link">
      Scripts usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/preprocess/" title="preprocess.lua" class="md-nav__link">
      preprocess.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/train/" title="train.lua" class="md-nav__link">
      train.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/translate/" title="translate.lua" class="md-nav__link">
      translate.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/tag/" title="tag.lua" class="md-nav__link">
      tag.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/lm/" title="lm.lua" class="md-nav__link">
      lm.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/build_vocab/" title="tools/build_vocab.lua" class="md-nav__link">
      tools/build_vocab.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/release_model/" title="tools/release_model.lua" class="md-nav__link">
      tools/release_model.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/tokenize/" title="tools/tokenize.lua" class="md-nav__link">
      tools/tokenize.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/learn_bpe/" title="tools/learn_bpe.lua" class="md-nav__link">
      tools/learn_bpe.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/server/" title="tools/translation_server.lua" class="md-nav__link">
      tools/translation_server.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/rest_server/" title="tools/rest_translation_server.lua" class="md-nav__link">
      tools/rest_translation_server.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/embeddings/" title="tools/embeddings.lua" class="md-nav__link">
      tools/embeddings.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/average_models/" title="tools/average_models.lua" class="md-nav__link">
      tools/average_models.lua
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../lua_python_comparison/" title="Lua and Python OpenNMT" class="md-nav__link">
      Lua and Python OpenNMT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../references/" title="References" class="md-nav__link">
      References
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../issues/" title="Common issues" class="md-nav__link">
      Common issues
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hypotheses-filtering" title="Hypotheses filtering" class="md-nav__link">
    Hypotheses filtering
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#normalization" title="Normalization" class="md-nav__link">
    Normalization
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#length-normalization" title="Length normalization" class="md-nav__link">
    Length normalization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coverage-normalization" title="Coverage normalization" class="md-nav__link">
    Coverage normalization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-of-sentence-normalization" title="End of sentence normalization" class="md-nav__link">
    End of sentence normalization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoding-with-auxiliary-language-model" title="Decoding with auxiliary language model" class="md-nav__link">
    Decoding with auxiliary language model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-attention-to-a-file" title="Output attention to a file" class="md-nav__link">
    Output attention to a file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualizing-the-beam-search" title="Visualizing the beam search" class="md-nav__link">
    Visualizing the beam search
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/OpenNMT/OpenNMT/edit/master/docs/translation/beam_search.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Beam search</h1>
                
                <p>By default, translation is done using beam search. The <code>-beam_size</code> option can be used to trade-off translation time and search accuracy, with <code>-beam_size 1</code> giving greedy search. The small default beam size is often enough in practice.</p>
<p>Beam search can also be used to provide an approximate n-best list of translations by setting <code>-n_best</code> greater than 1. For analysis, the translation command also takes an oracle/gold <code>-tgt</code> file and will output a comparison of scores.</p>
<h2 id="hypotheses-filtering">Hypotheses filtering<a class="headerlink" href="#hypotheses-filtering" title="Permanent link">&para;</a></h2>
<p>The beam search provides a built-in filter based on unknown words: <code>-max_num_unks</code>. Hypotheses with more unknown words than this value are dropped.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As dropped hypotheses temporarily reduce the beam size, the <code>-pre_filter_factor</code> is a way to increase the number of considered hypotheses before applying filters.</p>
</div>
<h2 id="normalization">Normalization<a class="headerlink" href="#normalization" title="Permanent link">&para;</a></h2>
<p>The beam search also supports various normalization techniques that are disabled by default and can be used to biased the scores generated by the model:</p>
<p>$$s(Y,X)=\frac{\log P(Y|X)}{lp(Y)}+cp(X,Y)$$</p>
<p>where (X) is the source, (Y) is the current target, and the functions as defined below. An additional penalty on end of sentence tokens can also be added to prioritize longer sentences.</p>
<h3 id="length-normalization">Length normalization<a class="headerlink" href="#length-normalization" title="Permanent link">&para;</a></h3>
<p>Scores are normalized by the following formula as defined in <a href="../../references/#GNMT">Wu et al. (2016)</a>:</p>
<p>$$lp(Y) = \frac{(5+|Y|)^\alpha}{(5+1)^\alpha}$$</p>
<p>where (|Y|) is the current target length and (\alpha) is the length normalization coefficient <code>-length_norm</code>.</p>
<h3 id="coverage-normalization">Coverage normalization<a class="headerlink" href="#coverage-normalization" title="Permanent link">&para;</a></h3>
<p>Scores are penalized by the following formula as defined in <a href="../../references/#GNMT">Wu et al. (2016)</a>:</p>
<p>$$cp(X,Y) = \beta\sum_{i=1}^{|X|}\log(\min(\sum_{j=1}^{|Y|}p_{i,j},1.0))$$</p>
<p>where (p_{i,j}) is the attention probability of the (j)-th target word (y_j) on the (i)-th source word (x_i), (|X|) is the source length, (|Y|) is the current target length and (\beta) is the coverage normalization coefficient <code>-coverage_norm</code>.</p>
<h3 id="end-of-sentence-normalization">End of sentence normalization<a class="headerlink" href="#end-of-sentence-normalization" title="Permanent link">&para;</a></h3>
<p>The score of the end of sentence token is penalized by the following formula:</p>
<p>$$ep(X,Y)=\gamma\frac{|X|}{|Y|}$$</p>
<p>where (|X|) is the source length, (|Y|) is the current target length and (\gamma) is the end of sentence normalization coefficient <code>-eos_norm</code>.</p>
<h2 id="decoding-with-auxiliary-language-model">Decoding with auxiliary language model<a class="headerlink" href="#decoding-with-auxiliary-language-model" title="Permanent link">&para;</a></h2>
<p>Beam search can use an additional language model to modify score of each option as defined in <a href="../../references/#LMShallowFusion">Gulcehre et al. (2015)</a> as "Shallow Fusion":</p>
<p>$$s(Y,X) = s_{TM}(Y,X) + \beta.s_{LM}(Y)$$</p>
<p>Where (s_{LM}(Y)) is the language model log-probability of the sequence  (Y) and (\beta) is defined by <code>-lm_weight</code> parameter.
To activate the language model, simply use <code>-lm_model lm.t7</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The language model cannot use bidirectional RNN and needs to share the same vocabulary (tokens and features) than the translation model.</p>
</div>
<h2 id="output-attention-to-a-file">Output attention to a file<a class="headerlink" href="#output-attention-to-a-file" title="Permanent link">&para;</a></h2>
<p>The option <code>-save_attention FILE</code> can be used to save attention state to a file during translation. The format of the file is as following (compatible with NEMATUS):</p>
<div class="codehilite"><pre><span></span>sentence id ||| target words ||| score ||| source words ||| number of source words ||| number of target words
ALIGNMENT FOR T_1
ALIGNMENT FOR T_2
...
ALIGNMENT FOR T_n
</pre></div>


<p>Where <code>T_1</code> ... <code>T_n</code> are the target words - each alignement line is space separated probability to source word.</p>
<h2 id="visualizing-the-beam-search">Visualizing the beam search<a class="headerlink" href="#visualizing-the-beam-search" title="Permanent link">&para;</a></h2>
<p>To visualize the beam search exploration, you can use the option <code>-save_beam_to beam.json</code>. It will save a JSON serialization of the beam search history.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This option requires the <code>dkjson</code> package.</p>
</div>
<p>This representation can then be visualized dynamically using the <code>generate_beam_viz.py</code> script from the <a href="https://github.com/OpenNMT/VisTools"><code>OpenNMT/VisTools</code></a> repository:</p>
<div class="codehilite"><pre><span></span>git clone https://github.com/OpenNMT/VisTools.git
<span class="nb">cd</span> VisTools
mkdir out/
python generate_beam_viz.py -d ~/OpenNMT/beam.json -o out/
firefox out/000000.html
</pre></div>


<p><img alt="Beam search visualization" src="../../img/beam_search.png" /></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../inference/" title="Inference" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Inference
              </span>
            </div>
          </a>
        
        
          <a href="../unknowns/" title="Unknown words" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Unknown words
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://opennmt.net" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/OpenNMT/OpenNMT" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-f3ab9e5ff8.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
      
        <script src="../../js/version-select.js"></script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-89222039-1","opennmt.net"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>