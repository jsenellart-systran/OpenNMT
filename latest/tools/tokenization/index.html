
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.10.2">
    
    
      
        <title>Tokenization - OpenNMT</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-408828a02a.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="OpenNMT" class="md-header-nav__button md-logo">
          
            
              <img src="../../img/logo-alpha.png" width="24" height="24">
            
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Tools
                </span>
              
            
            Tokenization
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/OpenNMT/OpenNMT" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      OpenNMT/OpenNMT
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <div class="md-nav__button md-logo">
      
        
          <img src="../../img/logo-alpha.png">
        
      
    </div>
    OpenNMT
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/OpenNMT/OpenNMT" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      OpenNMT/OpenNMT
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quickstart/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../applications/" title="Applications" class="md-nav__link">
      Applications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/preparation/" title="Preparation" class="md-nav__link">
      Preparation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../data/word_features/" title="Word features" class="md-nav__link">
      Word features
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Training
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Training
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/models/" title="Models" class="md-nav__link">
      Models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/embeddings/" title="Embeddings" class="md-nav__link">
      Embeddings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/logs/" title="Logs" class="md-nav__link">
      Logs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/multi_gpu/" title="Multi GPU" class="md-nav__link">
      Multi GPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/retraining/" title="Retraining" class="md-nav__link">
      Retraining
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/regularization/" title="Regularization" class="md-nav__link">
      Regularization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/decay/" title="Decay strategies" class="md-nav__link">
      Decay strategies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../training/sampling/" title="Data sampling" class="md-nav__link">
      Data sampling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Translation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Translation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../translation/inference/" title="Inference" class="md-nav__link">
      Inference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../translation/beam_search/" title="Beam search" class="md-nav__link">
      Beam search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../translation/unknowns/" title="Unknown words" class="md-nav__link">
      Unknown words
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Tokenization
      </label>
    
    <a href="./" title="Tokenization" class="md-nav__link md-nav__link--active">
      Tokenization
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#normalization" title="Normalization" class="md-nav__link">
    Normalization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenization" title="Tokenization" class="md-nav__link">
    Tokenization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detokenization" title="Detokenization" class="md-nav__link">
    Detokenization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-characters" title="Special characters" class="md-nav__link">
    Special characters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mixed-casing-words" title="Mixed casing words" class="md-nav__link">
    Mixed casing words
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alphabet-segmentation" title="Alphabet Segmentation" class="md-nav__link">
    Alphabet Segmentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#number-segmentation" title="Number Segmentation" class="md-nav__link">
    Number Segmentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bpe" title="BPE" class="md-nav__link">
    BPE
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scorer/" title="Scorer" class="md-nav__link">
      Scorer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../servers/" title="Servers" class="md-nav__link">
      Servers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Reference: Options
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Reference: Options
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/usage/" title="Scripts usage" class="md-nav__link">
      Scripts usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/preprocess/" title="preprocess.lua" class="md-nav__link">
      preprocess.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/train/" title="train.lua" class="md-nav__link">
      train.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/translate/" title="translate.lua" class="md-nav__link">
      translate.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/tag/" title="tag.lua" class="md-nav__link">
      tag.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/lm/" title="lm.lua" class="md-nav__link">
      lm.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/build_vocab/" title="tools/build_vocab.lua" class="md-nav__link">
      tools/build_vocab.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/release_model/" title="tools/release_model.lua" class="md-nav__link">
      tools/release_model.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/tokenize/" title="tools/tokenize.lua" class="md-nav__link">
      tools/tokenize.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/learn_bpe/" title="tools/learn_bpe.lua" class="md-nav__link">
      tools/learn_bpe.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/server/" title="tools/translation_server.lua" class="md-nav__link">
      tools/translation_server.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/rest_server/" title="tools/rest_translation_server.lua" class="md-nav__link">
      tools/rest_translation_server.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/embeddings/" title="tools/embeddings.lua" class="md-nav__link">
      tools/embeddings.lua
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../options/average_models/" title="tools/average_models.lua" class="md-nav__link">
      tools/average_models.lua
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../lua_python_comparison/" title="Lua and Python OpenNMT" class="md-nav__link">
      Lua and Python OpenNMT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../references/" title="References" class="md-nav__link">
      References
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../issues/" title="Common issues" class="md-nav__link">
      Common issues
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#normalization" title="Normalization" class="md-nav__link">
    Normalization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenization" title="Tokenization" class="md-nav__link">
    Tokenization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detokenization" title="Detokenization" class="md-nav__link">
    Detokenization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#special-characters" title="Special characters" class="md-nav__link">
    Special characters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mixed-casing-words" title="Mixed casing words" class="md-nav__link">
    Mixed casing words
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alphabet-segmentation" title="Alphabet Segmentation" class="md-nav__link">
    Alphabet Segmentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#number-segmentation" title="Number Segmentation" class="md-nav__link">
    Number Segmentation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bpe" title="BPE" class="md-nav__link">
    BPE
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/OpenNMT/OpenNMT/edit/master/docs/tools/tokenization.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Tokenization</h1>
                
                <p>OpenNMT provides generic tokenization utilities to quickly process new training data. The goal of the tokenization is to convert raw sentences into sequences of tokens. In that process two main operations are performed in sequence:</p>
<ul>
<li>normalization - which applies some uniform transformation on the source sequences to identify and protect some specific sequences (for instance url), normalize characters (for instance all types of quotes, unicode variants) or even to normalize some variants (like dates) into unique representation simpler for the translation process</li>
<li>the tokenization itself - which transform the actual normalized sentence into a sequence of space-separated tokens together with possible features (case).</li>
</ul>
<h2 id="normalization">Normalization<a class="headerlink" href="#normalization" title="Permanent link">&para;</a></h2>
<p>Normalization is performed by user commandline tool which has to work in "pipeline" mode: sentences from standard input are normalized and produced on the standard output. For instance, the following python script is normalizing unicode representation (using NFC representation), turns French quotes <code>«»</code> into English quotes <code>“”</code>, and protect "hashtags" sequences:</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
  <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
  <span class="n">line</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFC&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
  <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;«&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;“&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;»&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;”&quot;</span><span class="p">)</span>
  <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(^|[^S\w])#([A-Za-z0-9_]+)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">1｟#</span><span class="se">\\</span><span class="s1">2｠&#39;</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>


<p>Normalization script is called as part of tokenization adding the option <code>-normalize_cmd "normalize.py"</code>.</p>
<h2 id="tokenization">Tokenization<a class="headerlink" href="#tokenization" title="Permanent link">&para;</a></h2>
<p>To tokenize a corpus:</p>
<div class="codehilite"><pre><span></span>th tools/tokenize.lua OPTIONS &lt; file &gt; file.tok
</pre></div>


<p>Available tokenization modes are defined <a href="http://opennmt.net/OpenNMT/options/tokenize/">here</a>.</p>
<p>In order to perform <code>detokenization</code>, tokenization can introduce a joiner annotation mark <code>￭</code>.</p>
<h2 id="detokenization">Detokenization<a class="headerlink" href="#detokenization" title="Permanent link">&para;</a></h2>
<p>If you activate <code>-joiner_annotate</code> marker, the tokenization is reversible. Just use:</p>
<div class="codehilite"><pre><span></span>th tools/detokenize.lua OPTIONS &lt; file.tok &gt; file.detok
</pre></div>


<h2 id="special-characters">Special characters<a class="headerlink" href="#special-characters" title="Permanent link">&para;</a></h2>
<ul>
<li><code>￨</code> (U+FFE8) is the feature separator symbol. If such character is used in source text, it is replaced by its non presentation form <code>│</code> (U+2502).</li>
<li><code>￭</code> (U+FFED) is the default joiner marker (generated in <code>-joiner_annotate marker</code> mode). If such character is used in source text, it is replaced by its non presentation form <code>■</code> (U+25A0)</li>
<li><code>｟...｠</code> (U+FF5F, U+FF60) are marking a sequence as protected - it won't be tokenized and its case feature is <code>N</code>.</li>
</ul>
<h2 id="mixed-casing-words">Mixed casing words<a class="headerlink" href="#mixed-casing-words" title="Permanent link">&para;</a></h2>
<p><code>-segment_case</code> feature enables tokenizer to segment words into subwords with one of 3 casing types (truecase ('House'), uppercase ('HOUSE') or lowercase ('house')), which helps  restore right casing during  detokenization. This feature is especially useful for texts with a signficant number of words with mixed casing ('WiFi' -&gt; 'Wi' and 'Fi').</p>
<div class="codehilite"><pre><span></span>WiFi --&gt; wi￨C fi￨C
TVs --&gt; tv￨U s￨L
</pre></div>


<h2 id="alphabet-segmentation">Alphabet Segmentation<a class="headerlink" href="#alphabet-segmentation" title="Permanent link">&para;</a></h2>
<p>Two options provide specific tokenization depending on alphabet:</p>
<ul>
<li><code>-segment_alphabet_change</code>: tokenize a sequence between two letters when their alphabets differ - for instance between a Latin alphabet character and a Han character.</li>
<li><code>-segment_alphabet Alphabet</code>: tokenize all words of the indicated alphabet into characters - for instance to split a chinese sentence into characters, use <code>-segment_alphabet Han</code>:</li>
</ul>
<div class="codehilite"><pre><span></span>君子之心不胜其小，而气量涵盖一世。 --&gt; 君 子 之 心 不 胜 其 小 ， 而 气 量 涵 盖 一 世 。
</pre></div>


<h2 id="number-segmentation">Number Segmentation<a class="headerlink" href="#number-segmentation" title="Permanent link">&para;</a></h2>
<p>The option <code>-segment_number</code> tokenizes numbers by digits. This option is interesting for full handling of numeric entities conversion/translation by neural networks.</p>
<div class="codehilite"><pre><span></span>1984 --&gt; 1 9 8 4
</pre></div>


<h2 id="bpe">BPE<a class="headerlink" href="#bpe" title="Permanent link">&para;</a></h2>
<p>OpenNMT's BPE module fully supports the <a href="https://github.com/rsennrich/subword-nmt">original BPE</a> as default mode:</p>
<div class="codehilite"><pre><span></span>tools/learn_bpe.lua -size <span class="m">30000</span> -save_bpe codes &lt; input_tokenized
tools/tokenize.lua -bpe_model codes &lt; input_tokenized
</pre></div>


<p>with three additional features:</p>
<p><strong>1. Accept raw text as input and use OpenNMT's tokenizer for pre-tokenization before BPE training</strong></p>
<div class="codehilite"><pre><span></span>tools/learn_bpe.lua -size <span class="m">30000</span> -save_bpe codes -tok_mode aggressive -tok_segment_alphabet_change <span class="o">[</span> OTHER_TOK_OPTIONS <span class="o">]</span> <span class="o">[</span> OTHER_BPE_TRAINING_OPTIONS <span class="o">]</span> &lt; input_raw
tools/tokenize.lua -bpe_model codes -mode aggressive -segment_alphabet_change <span class="o">[</span> SAME_TOK_OPTIONS <span class="o">]</span> <span class="o">[</span> OTHER_BPE_INFERENCE_OPTIONS <span class="o">]</span> &lt; input_raw
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All TOK_OPTIONS for learn_bpe.lua have their equivalent for tokenize.lua without the prefix <code>tok_</code>
BPE_INFERENCE_OPTIONS for tokenize.lua are those of Tokenizer options with the prefix <code>bpe_</code></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When applying BPE for any data set, the same TOK_OPTIONS should be used for learn_bpe.lua and tokenize.lua</p>
</div>
<p><strong>2. Add BPE_TRAINING_OPTION for different modes of handling prefixes and/or suffixes: <code>-bpe_mode</code></strong></p>
<ul>
<li><code>suffix</code>: BPE merge operations are learnt to distinguish sub-tokens like "ent" in the middle of a word and "ent&lt;\w&gt;" at the end of a word. "&lt;\w&gt;" is an artificial marker appended to the end of each token input and treated as a single unit before doing statistics on bigrams. This is the default mode which is useful for most of the languages.</li>
<li><code>prefix</code>: BPE merge operations are learnt to distinguish sub-tokens like "ent" in the middle of a word and "&lt;w>ent" at the beginning of a word. "&lt;w>" is an artificial marker appended to the beginning of each token input and treated as a single unit before doing statistics on bigrams.</li>
<li><code>both</code>: <code>suffix</code> + <code>prefix</code></li>
<li><code>none</code>: No artificial marker is appended to input tokens, a sub-token is treated equally whether it is in the middle or at the beginning or at the end of a token.</li>
</ul>
<p><strong>3. Add BPE_INFERENCE_OPTION for BPE in addition to the case feature: <code>-bpe_case_insensitive</code></strong></p>
<p>OpenNMT's tokenization flow first applies BPE then add the case feature for each input token. With the standard BPE, "Constitution" and "constitution" may result in the different sequences of sub-tokens:</p>
<div class="codehilite"><pre><span></span>Constitution --&gt; con￨C sti￨l tu￨l tion￨l
constitution --&gt; consti￨l tu￨l tion￨l
</pre></div>


<p>If you want a <em>caseless</em> split so that you can take the best from using case feature, and you can achieve that with the following command lines:</p>
<div class="codehilite"><pre><span></span><span class="c1"># We don&#39;t need BPE to care about case</span>
tools/learn_bpe.lua -size <span class="m">30000</span> -save_bpe codes_lc -tok_case_feature <span class="o">[</span> OTHER_TOK_OPTIONS <span class="o">]</span> <span class="o">[</span> OTHER_BPE_TRAINING_OPTIONS <span class="o">]</span> &lt; input_raw

<span class="c1"># The case information is preserved in the true case input</span>
tools/tokenize.lua -bpe_model codes_lc -bpe_case_insensitive -case_feature <span class="o">[</span> SAME_TOK_OPTIONS <span class="o">]</span> <span class="o">[</span> OTHER_BPE_INFERENCE_OPTIONS <span class="o">]</span> &lt; input_raw
</pre></div>


<p>The output of the previous example would be:</p>
<div class="codehilite"><pre><span></span>Constitution --&gt; con￨C sti￨l tu￨l tion￨l
constitution --&gt; con￨l sti￨l tu￨l tion￨l
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../translation/unknowns/" title="Unknown words" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Unknown words
              </span>
            </div>
          </a>
        
        
          <a href="../scorer/" title="Scorer" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Scorer
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://opennmt.net" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/OpenNMT/OpenNMT" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-f3ab9e5ff8.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-89222039-1","opennmt.net"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>