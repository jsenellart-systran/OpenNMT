<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Models - OpenNMT</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-89222039-1', 'opennmt.net');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">OpenNMT</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Overview</a>
                    </li>
                    <li >
                        <a href="../../installation/">Installation</a>
                    </li>
                    <li >
                        <a href="../../quickstart/">Quickstart</a>
                    </li>
                    <li >
                        <a href="../../applications/">Applications</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Data <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../data/preparation/">Preparation</a>
</li>
                            
<li >
    <a href="../../data/word_features/">Word features</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Training <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li class="active">
    <a href="./">Models</a>
</li>
                            
<li >
    <a href="../embeddings/">Embeddings</a>
</li>
                            
<li >
    <a href="../logs/">Logs</a>
</li>
                            
<li >
    <a href="../multi_gpu/">Multi GPU</a>
</li>
                            
<li >
    <a href="../retraining/">Retraining</a>
</li>
                            
<li >
    <a href="../regularization/">Regularization</a>
</li>
                            
<li >
    <a href="../decay/">Decay strategies</a>
</li>
                            
<li >
    <a href="../sampling/">Data sampling</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Translation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../translation/inference/">Inference</a>
</li>
                            
<li >
    <a href="../../translation/beam_search/">Beam search</a>
</li>
                            
<li >
    <a href="../../translation/unknowns/">Unknown words</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tools <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../tools/tokenization/">Tokenization</a>
</li>
                            
<li >
    <a href="../../tools/scorer/">Scorer</a>
</li>
                            
<li >
    <a href="../../tools/servers/">Servers</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference: Options <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../options/usage/">Scripts usage</a>
</li>
                            
<li >
    <a href="../../options/preprocess/">preprocess.lua</a>
</li>
                            
<li >
    <a href="../../options/train/">train.lua</a>
</li>
                            
<li >
    <a href="../../options/translate/">translate.lua</a>
</li>
                            
<li >
    <a href="../../options/tag/">tag.lua</a>
</li>
                            
<li >
    <a href="../../options/lm/">lm.lua</a>
</li>
                            
<li >
    <a href="../../options/build_vocab/">tools/build_vocab.lua</a>
</li>
                            
<li >
    <a href="../../options/release_model/">tools/release_model.lua</a>
</li>
                            
<li >
    <a href="../../options/tokenize/">tools/tokenize.lua</a>
</li>
                            
<li >
    <a href="../../options/learn_bpe/">tools/learn_bpe.lua</a>
</li>
                            
<li >
    <a href="../../options/server/">tools/translation_server.lua</a>
</li>
                            
<li >
    <a href="../../options/rest_server/">tools/rest_translation_server.lua</a>
</li>
                            
<li >
    <a href="../../options/embeddings/">tools/embeddings.lua</a>
</li>
                            
<li >
    <a href="../../options/average_models/">tools/average_models.lua</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../../lua_python_comparison/">Lua and Python OpenNMT</a>
                    </li>
                    <li >
                        <a href="../../references/">References</a>
                    </li>
                    <li >
                        <a href="../../issues/">Common issues</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../../data/word_features/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../embeddings/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/OpenNMT/OpenNMT">OpenNMT/OpenNMT
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#encoders">Encoders</a></li>
            <li><a href="#default-encoder">Default encoder</a></li>
            <li><a href="#bidirectional-encoder">Bidirectional encoder</a></li>
            <li><a href="#pyramidal-deep-bidirectional-encoder">Pyramidal deep bidirectional encoder</a></li>
            <li><a href="#deep-bidirectional-encoder">Deep bidirectional encoder</a></li>
            <li><a href="#googles-nmt-encoder">Google's NMT encoder</a></li>
            <li><a href="#convolutional-encoder">Convolutional encoder</a></li>
        <li class="main "><a href="#decoders">Decoders</a></li>
            <li><a href="#default-decoder">Default decoder</a></li>
        <li class="main "><a href="#residual-connections">Residual connections</a></li>
        <li class="main "><a href="#bridges">Bridges</a></li>
        <li class="main "><a href="#attention-model">Attention Model</a></li>
        <li class="main "><a href="#scheduled-sampling">Scheduled Sampling</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>In addition to standard dimension settings like the number of layers, the hidden dimension size, etc., OpenNMT also provides various model architecture.</p>
<h2 id="encoders">Encoders<a class="headerlink" href="#encoders" title="Permanent link">&para;</a></h2>
<h3 id="default-encoder">Default encoder<a class="headerlink" href="#default-encoder" title="Permanent link">&para;</a></h3>
<p>The default encoder is a simple recurrent neural network (LSTM or GRU).</p>
<h3 id="bidirectional-encoder">Bidirectional encoder<a class="headerlink" href="#bidirectional-encoder" title="Permanent link">&para;</a></h3>
<p>The bidirectional encoder (<code>-encoder_type brnn</code>) consists of two independent encoders: one encoding the normal sequence and the other the reversed sequence. The output and final states are concatenated or summed depending on the <code>-brnn_merge</code> option.</p>
<p><img alt="Bidirectional encoder" src="../../img/brnn.png" /></p>
<h3 id="pyramidal-deep-bidirectional-encoder">Pyramidal deep bidirectional encoder<a class="headerlink" href="#pyramidal-deep-bidirectional-encoder" title="Permanent link">&para;</a></h3>
<p>The pyramidal deep bidirectional encoder (<code>-encoder_type pdbrnn</code>) is an alternative bidirectional encoder that reduces the time dimension after <strong>each</strong> layer based on the <code>-pdbrnn_reduction</code> factor and using <code>-pdbrnn_merge</code> as the reduction action (sum or concatenation).</p>
<p><img alt="Pyramidal deep bidirectional encoder" src="../../img/pdbrnn.png" /></p>
<h3 id="deep-bidirectional-encoder">Deep bidirectional encoder<a class="headerlink" href="#deep-bidirectional-encoder" title="Permanent link">&para;</a></h3>
<p>The deep bidirectional encoder (<code>-encoder_type dbrnn</code>) is an alternative bidirectional encoder where the outputs of every layers are summed (or concatenated) prior feeding to the next layer. It is a special case of a pyramidal deep bidirectional encoder without time reduction (i.e. <code>-pdbrnn_reduction = 1</code>).</p>
<p><img alt="Deep bidirectional encoder" src="../../img/dbrnn.png" /></p>
<h3 id="googles-nmt-encoder">Google's NMT encoder<a class="headerlink" href="#googles-nmt-encoder" title="Permanent link">&para;</a></h3>
<p>The Google encoder (<code>-encoder_type gnmt</code>) is an encoder with a single bidirectional layer as described in <a href="../../references/#GNMT">Wu et al. (2016)</a>. The bidirectional states are concatenated and residual connections are enabled by default.</p>
<p><img alt="Google's NMT encoder" src="../../img/gnmt-encoder.png" /></p>
<h3 id="convolutional-encoder">Convolutional encoder<a class="headerlink" href="#convolutional-encoder" title="Permanent link">&para;</a></h3>
<p>The convolutional encoder (<code>-encoder_type cnn</code>) is an encoder based on several convolutional layers as described in <a href="../../references/#CNNEncoder">Gehring et al. (2017)</a>.</p>
<p>In sequence-to-sequence models, it should be used either without a bridge or with a dense bridge (options <code>-bridge dense</code>, <code>-bridge dense_nonlinear</code>, or <code>-bridge none</code>). The default <code>copy</code> bridge is not compatible with this encoder.</p>
<p>It is also recommended to set a small learning rate when using SGD (e.g. <code>-learning_rate 0.1</code>) or use Adam instead (e.g. <code>-optim adam -learning_rate 0.0002</code>).</p>
<h2 id="decoders">Decoders<a class="headerlink" href="#decoders" title="Permanent link">&para;</a></h2>
<h3 id="default-decoder">Default decoder<a class="headerlink" href="#default-decoder" title="Permanent link">&para;</a></h3>
<p>The default decoder applies attention over the source sequence and implements input feeding by default.</p>
<p>Input feeding is an approach to feed attentional vectors "<em>as inputs to the next time steps to inform the model about past alignment decisions</em>" (<a href="https://arxiv.org/pdf/1508.04025.pdf">Luong et al. (2015)</a>). This can be disabled by setting <code>-input_feed 0</code>.</p>
<p><img alt="Decoder with input feeding" src="../../img/input_feed.png" /></p>
<h2 id="residual-connections">Residual connections<a class="headerlink" href="#residual-connections" title="Permanent link">&para;</a></h2>
<p>With residual connections the input of a layer is element-wise added to the output before feeding to the next layer. This approach proved to be useful for the gradient flow with deep RNN stacks (more than 4 layers).</p>
<p><img alt="RNN with residual connections" src="../../img/residual.png" /></p>
<p>The following components support residual connections with the <code>-residual</code> flag:</p>
<ul>
<li>default encoder</li>
<li>bidirectional encoder</li>
<li>default decoder</li>
</ul>
<h2 id="bridges">Bridges<a class="headerlink" href="#bridges" title="Permanent link">&para;</a></h2>
<p>A bridge is an additional layer between the encoder and the decoder that defines how to pass the encoder states to the decoder. It can be one of the following:</p>
<ul>
<li><code>-bridge copy</code> (default): the encoder states are copied</li>
<li><code>-bridge dense</code>: the encoder states are forwaded through a dense layer</li>
<li><code>-bridge dense_nonlinear</code>: the encoder states are forwaded through a dense layer followed by a non-linearity, here (tanh)</li>
<li><code>-bridge none</code>: the encoder states are not passed and the decoder initial states are set to zero</li>
</ul>
<p>With the <code>copy</code> bridge, encoder and decoder should have the same structure (number of layers, final hidden size, etc.).</p>
<h2 id="attention-model">Attention Model<a class="headerlink" href="#attention-model" title="Permanent link">&para;</a></h2>
<p>Different models are available from <a href="../../references/#Luong2015">Luong (2015)</a> "Global Attention Model".</p>
<p><img alt="Global attentional model" src="../../img/global-attention-model.png" /></p>
<p>where:</p>
<p>$$a_t(s) = \frac{\mathrm{exp}(\mathrm{score}(h_t,\bar{h}<em>s))}{\sum</em>{s'} \mathrm{exp}(\mathrm{score}(h_t,\bar{h}_s)}$$</p>
<p>and the score function is one of these:</p>
<ul>
<li><code>dot</code>: $$\mathrm{score}(h_t,\bar{h}_s)=h_t^T\bar{h}_s$$</li>
<li><code>general</code>: $$\mathrm{score}(h_t,\bar{h}_s)=h_t^TW_a\bar{h}_s$$</li>
<li><code>concat</code>: $$\mathrm{score}(h_t,\bar{h}_s)=\nu_a^T.\mathrm{tanh}(W_a[h_t;\bar{h}_s])$$</li>
</ul>
<p>The model is selected using <code>-global_attention</code> option or can be disabled with <code>-attention none</code> option. The default attention model is <code>general</code>.</p>
<h2 id="scheduled-sampling">Scheduled Sampling<a class="headerlink" href="#scheduled-sampling" title="Permanent link">&para;</a></h2>
<p>By default, the decoder at step (t) is using the reference token for step (t-1) to calculate the new output. For some applications, for instance speech recognition, this is leading to propagation of decoding errors and also a mismatch between training and inference workflow. Scheduled sampling (as introduced in <a href="http://papers.nips.cc/paper/5956-scheduled-sampling-for-sequence-prediction-with-recurrent-neural-networks.pdf">Scheduled sampling for sequence prediction with recurrent neural networks</a>. In Advances in Neural Information Processing Systems (pp. 1171-1179).]) is allowing to mix gold reference and generated output in a proportion that will change over time: at the beginning of the training the generated output confidence is very low and it is better to use gold reference, while at the end of the training, we have to rely on generated output to have training in the same conditions than inference.</p>
<p>Scheduled sampling is activated with <code>-scheduled_sampling</code> parameter which takes the probability to use the reference token instead of the previously generated one. By default, probability is one meaning that we always use previously generated token. The sampling can be done either at each token level or at the sentence level using <code>-scheduled_sampling_scope</code> parameter. The decay of the sampling rate is controlled by parameters <code>-scheduled_sampling_decay_type</code> and <code>-scheduled_sampling_decay_rate</code>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
